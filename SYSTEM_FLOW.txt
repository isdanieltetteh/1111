===================================================================================
                    ADVERTISEMENT SYSTEM - COMPLETE FLOW DIAGRAM
===================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              USER FLOW                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. USER VISITS BUY ADS PAGE
   â†“
   /buy-ads.php
   â†“
   [Select Ad Type: Banner or Text]
   â†“
   [Select Duration: 1, 3, 7, 10, or 30 days]
   â†“
   [Choose Visibility: Standard or Premium]
   â†“
   [Select Ad Space from dropdown]
   - Shows all enabled ad spaces
   - Displays dimensions and price multiplier
   â†“
   [Enter Ad Content]
   - Banner: Upload image â†’ LIVE PREVIEW shows uploaded image
   - Text: Type headline & description â†’ LIVE PREVIEW updates in real-time
   â†“
   [Review Pricing]
   - Base Price (from ad_pricing table)
   - Ã— Space Multiplier (from ad_spaces.base_price_multiplier)
   - Ã— Premium Multiplier (if premium selected)
   = Total Cost
   â†“
   [Purchase with Credits]
   - Checks user balance
   - Deducts credits
   - Creates ad record with status='pending'
   â†“
   [Awaits Admin Approval]


2. ADMIN APPROVAL
   â†“
   Admin reviews ad in /admin/ads.php
   â†“
   Approves â†’ status='active', start_date=NOW(), end_date=NOW()+duration
   Rejects â†’ status='rejected'


3. AD DISPLAY ON PAGES
   â†“
   Page includes: <?php displayAdSpace('space_id'); ?>
   â†“
   System checks database:

   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Query: Find active ads for this space      â”‚
   â”‚ WHERE:                                      â”‚
   â”‚   - status = 'active'                       â”‚
   â”‚   - start_date <= NOW()                     â”‚
   â”‚   - end_date >= NOW()                       â”‚
   â”‚   - ad_space_id matches space               â”‚
   â”‚   - space is_enabled = 1                    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   IF AD EXISTS:
      â†“
      Display ad (banner image or text)
      Track impression (impression_count++)
      Log to ad_impressions table

   ELSE:
      â†“
      Display placeholder:
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  ğŸ“¢ Advertisement Space        â”‚
      â”‚  Available                     â”‚
      â”‚  728x90                        â”‚
      â”‚  [Advertise Here Button]       â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


4. CLICK TRACKING
   â†“
   User clicks ad
   â†“
   Redirects to /ad-click.php?id=<ad_id>
   â†“
   Tracks click:
   - Increment click_count in user_advertisements
   - Log to ad_clicks table (IP, user_agent, referrer)
   â†“
   Redirect to target_url

===================================================================================
                         ADMIN CONTROL PANEL FLOW
===================================================================================

/admin/ad-control.php
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DASHBOARD STATISTICS                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Total Spaces â”‚ Enabled      â”‚ Active Ads   â”‚ Impressions  â”‚  â”‚
â”‚  â”‚     24       â”‚     24       â”‚      3       â”‚   15,234     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚  â”‚   Clicks     â”‚   Revenue    â”‚                                 â”‚
â”‚  â”‚     892      â”‚  $1,245.50   â”‚                                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AD SPACES TABLE                                â”‚
â”‚  ID  | Name             | Impress. | Clicks | CTR   | Revenue   â”‚
â”‚  1   | Homepage Top     | 5,234    | 234    | 4.47% | $450.00   â”‚
â”‚  2   | Homepage Side #1 | 3,456    | 178    | 5.15% | $320.00   â”‚
â”‚  ...                                                               â”‚
â”‚                                                                    â”‚
â”‚  Actions per space:                                               â”‚
â”‚  [Enable/Disable] [Pricing] [Size]                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ADMIN ACTIONS:

1. ENABLE/DISABLE SPACE
   Click button â†’ Update ad_spaces.is_enabled
   - Disabled spaces don't show in user purchase dropdown
   - Existing ads still run until expiration

2. UPDATE PRICING
   Click "Pricing" â†’ Modal opens
   Set multiplier (e.g., 2.0)
   - Homepage top = 2.0x (premium location)
   - Sidebar = 1.5x
   - Bottom = 1.0x (standard)

3. UPDATE DIMENSIONS
   Click "Size" â†’ Modal opens
   Set width & height
   - Shown to users during purchase
   - Displayed in placeholder

===================================================================================
                         DATABASE STRUCTURE
===================================================================================

ad_spaces (24 records - pre-configured)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id | space_id            | space_name        | base_price_mult. â”‚
â”‚  1 | index_top_banner    | Homepage Top      | 2.00             â”‚
â”‚  2 | index_sidebar_1     | Homepage Side #1  | 1.50             â”‚
â”‚  3 | sites_top_banner    | Sites Top         | 1.80             â”‚
â”‚ ...                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘
         â”‚ (ad_space_id foreign key)
         â”‚
user_advertisements
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id | user_id | ad_type | ad_space_id | status  | start/end     â”‚
â”‚  1 |   42    | banner  |      1      | active  | 2025-10-01... â”‚
â”‚  2 |   53    | text    |      3      | pending | NULL          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â†’ ad_impressions (tracks every view)
         â””â”€â†’ ad_clicks (tracks every click)

ad_pricing (10 records)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ad_type | duration_days | base_price | premium_multiplier       â”‚
â”‚ banner  |      1        |   5.00     |        2.00              â”‚
â”‚ banner  |      7        |  25.00     |        2.00              â”‚
â”‚ text    |      7        |  15.00     |        2.00              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

===================================================================================
                         PRICE CALCULATION EXAMPLE
===================================================================================

USER SELECTS:
- Ad Type: Text
- Duration: 7 days
- Ad Space: Homepage Top Banner (multiplier = 2.0)
- Visibility: Premium

CALCULATION:
Step 1: Get base price from ad_pricing
  Text ad, 7 days = $15.00

Step 2: Apply space multiplier
  $15.00 Ã— 2.0 = $30.00

Step 3: Apply premium multiplier (if premium selected)
  $30.00 Ã— 2.0 = $60.00

TOTAL COST: $60.00

Shown to user as:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cost Summary                â”‚
â”‚ Base Price:      $30.00     â”‚
â”‚ Premium Upgrade: $30.00     â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚ Total Cost:      $60.00     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

===================================================================================
                         KEY FILES & FUNCTIONS
===================================================================================

FRONTEND (User-facing):
  /buy-ads.php
  - Main purchase interface
  - Live preview functionality
  - Price calculation display

  /includes/ad-widget.php
  â”œâ”€ displayAdSpace($space_id)     [NEW - Primary function]
  â”‚  - Shows active ad or placeholder
  â”‚  - Handles impression tracking
  â”‚  - Renders CTA button if no ad
  â”‚
  â””â”€ renderAdPlaceholder($space)   [NEW]
     - Creates attractive placeholder
     - Links to purchase page

BACKEND (Core Logic):
  /includes/ad-manager.php
  â”œâ”€ getAdForSpace($space_id)      [NEW]
  â”‚  - Retrieves active ad for specific space
  â”‚  - Implements rotation algorithm
  â”‚
  â”œâ”€ renderBannerAd($ad)
  â”‚  - Generates HTML for banner ads
  â”‚
  â””â”€ renderTextAd($ad)
     - Generates HTML for text ads

ADMIN:
  /admin/ad-control.php            [NEW - Complete Panel]
  - Dashboard statistics
  - Enable/disable spaces
  - Update pricing & dimensions
  - Performance metrics per space

AJAX:
  /ajax/get-ad.php
  - Returns ad data for dynamic loading

  /ad-click.php
  - Handles click tracking
  - Redirects to target URL

===================================================================================
                         INTEGRATION POINTS
===================================================================================

Add to ANY page:

<?php require_once 'includes/ad-widget.php'; ?>

Then insert ads:

<?php displayAdSpace('index_top_banner'); ?>      â† Homepage top
<?php displayAdSpace('sites_between_results_1'); ?> â† Between listings
<?php displayAdSpace('dashboard_sidebar'); ?>      â† Dashboard side

That's it! System handles:
âœ“ Finding active ads
âœ“ Displaying them
âœ“ Tracking impressions
âœ“ Tracking clicks
âœ“ Showing placeholders when empty
âœ“ Fair rotation
âœ“ Performance metrics

===================================================================================
                         ROTATION ALGORITHM
===================================================================================

When displayAdSpace() is called:

1. Query database for matching ads
   WHERE:
     - ad_space_id matches
     - status = 'active'
     - start_date <= NOW()
     - end_date >= NOW()
     - space is_enabled = 1

2. Order results by:
   Priority 1: visibility_level (premium first)
   Priority 2: RAND() (random within priority group)

3. LIMIT 1 (select first result)

4. Track impression:
   - Update user_advertisements.impression_count
   - Insert into ad_impressions table

5. Render ad HTML

Result: Premium ads show more often, but fair rotation within each tier.

===================================================================================
                         SECURITY MEASURES
===================================================================================

âœ“ SQL Injection: All queries use prepared statements
âœ“ XSS: All output escaped with htmlspecialchars()
âœ“ CSRF: Form actions verified
âœ“ File Upload: Image type validation, size limits
âœ“ Authentication: Login required for purchases
âœ“ Authorization: Admin-only for control panel
âœ“ Credit Verification: Balance checked before purchase
âœ“ Input Validation: All user input sanitized

===================================================================================
